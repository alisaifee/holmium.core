language: python
addons:
  chrome: stable

python:
    - "2.7"
    - "3.5"
    - "3.7"
    - "3.8"

cache: pip
before_script:
  - CHROME_MAIN_VERSION=`google-chrome-stable --version | sed -E 's/(^Google Chrome |\.[0-9]+ )//g'`
  - CHROMEDRIVER_VERSION=`curl -s "https://chromedriver.storage.googleapis.com/LATEST_RELEASE_$CHROME_MAIN_VERSION"`
  - wget -O /tmp/chromedriver.zip http://chromedriver.storage.googleapis.com/$CHROMEDRIVER_VERSION/chromedriver_linux64.zip
  - mkdir $HOME/chromedriver && unzip /tmp/chromedriver.zip -d $HOME/chromedriver
  - export PATH=$HOME/chromedriver:$PATH

install:
  - pip install -r requirements/ci.txt

script:
    - nosetests tests --with-cov -v
    - python setup.py build sdist
    - pip install $(find dist/ -name \*.tar.gz | head -n 1)
after_success:
    - coveralls
